---
sidebar_position: 02
---

# MutationObserve 例子

为了防止大家对 MutationObserve 没有概念，我们归纳一些场景并总结出一些例子，方便大家更好的理解

# 子元素的监听修改

HTML 的格式为

```html
<body>
  <div class="target"></div>
</body>
```

代码为

```js
const target = document.querySelector(".target");
let observer = new MutationObserver(function (mutations) {
  console.log("mutations", mutations);
});
observer.observe(target, {
  childList: true,
});
const childList1 = document.createElement("div");
childList1.innerText = "div1";
target.append(childList1);
const childList2 = document.createElement("div");
childList2.innerText = "div2";
target.append(childList2);
childList2.remove();
childList1.remove();
```

最终输出为

```
mutations Array(4) [ MutationRecord, MutationRecord, MutationRecord, MutationRecord ]
```

我们可以看到出现了四次 Record，分别是下面四行代码触发的

```js
target.append(childList1);
target.append(childList2);
childList2.remove();
childList1.remove();
```

我们依次看每个 Record

### 第一个 Record

数据如下

```
addedNodes: NodeList [ div ],
attributeName: null,
attributeNamespace: null,
nextSibling: null,
oldValue: null,
previousSibling: null,
removedNodes: NodeList [],
target: <div class="target">,
type: "childList"
```

根据 type 为 childList 表示是子元素的增删操作，target 表示对哪个元素所进行的操作，其他的属性我们只需要关注 removedNodes/addedNodes，以及 previousSibling/nextSibling 四个属性。

其中 removedNodes 没有任何内容，表示没有删除任何元素，而 addedNodes 有一个 DOM 元素，是我们通过`target.append(childList1)`插入一个 childList1 元素所触发的，previousSibling 以及 nextSibling 都为 null，表示相邻的兄弟元素都不存在。

### 第二个 Record

数据如下

```
addedNodes: NodeList [ div ]
attributeName: null
attributeNamespace: null
nextSibling: null
oldValue: null
previousSibling: <div>
removedNodes: NodeList []
target: <div class="target">
type: "childList"
```

这里与上述基本一致，有所区别的是 previousSibling 不在为 null，因为第一次 Record 插入一个 div 后，我们又进行一次 append，此时插入的元素的相邻上一个元素，刚好是第一次 Record 的元素，结构如下

```html
<div class="target">
  <div>div1</div> //第一次Record插入的元素
  <div>div2</div> //第二次Record插入的元素，此时相邻的上一个兄弟元素为第一次插入的元素
</div>
```

### 第三个 Record

数据如下

```
addedNodes: NodeList []
attributeName: null
attributeNamespace: null
nextSibling: null
oldValue: null
previousSibling: <div>
removedNodes: NodeList [ div ]
target: <div class="target">
type: "childList"
```

这里对应了代码`childList2.remove();`，因为也属于子元素的增删改查，所以type依然是childList，但是这行代码仅仅做了删除操作，所以addedNodes为空，removedNodes表示删除了哪个元素，而previousSibling表示删除的元素节点的相邻兄弟节点的上一个节点，结构图如下

```html
<div class="target">
  <div>div1</div> //相邻兄弟节点的上一个节点
  <div>div2</div> //删除该元素
</div>
```

### 第四个 Record

数据如下

```
addedNodes: NodeList []
attributeName: null
attributeNamespace: null
nextSibling: null
oldValue: null
previousSibling: null
removedNodes: NodeList [ div ]
target: <div class="target">
type: "childList"
```

删除div1元素，此时div2已经被删除，所以previousSibling和nextSibling都为null


```html
<div class="target">
  <div>div1</div> //删除该元素
</div>
```
